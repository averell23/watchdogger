<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>File: README.rdoc</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



  <div id="fileHeader">
    <h1>README.rdoc</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>README.rdoc
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Thu Jul 16 17:00:22 +0200 2009</td>
    </tr>
    </table>
  </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <h1>Watchdogger</h1>
<p>
Watchdogger is a simple ruby program that will monitor your log file or web
page (and potentially other stuff, too) and take action if something is
amiss. It is intentionally simple, so there is less chance of having things
go wrong with the watchdog itself.
</p>
<p>
If you want to build more complicated reporting or such, you could do so
separately and act on notifications from the watchdog.
</p>
<h1>Installation</h1>
<p>
Should be a matter of a simple
</p>
<pre>
  gem install averell23-watchdogger
</pre>
<h1>Quick start</h1>
<p>
You will have to make a configuration file like this:
</p>
<pre>
  # Actions you want to execute
  actions:
    log_event:
      type: log_action
      severity: info
    restart_server:
      type: kill_process
      pidfile: /var/pid/server.pid
  # Watchers: Things you want to monitor
  watchers:
    check_my_site:
      type: http_watcher
      url: http://www.mysite.some/
      content_match: 'some.*other?string'
      actions:
        - log_event
        - restart_server
  # Run each minute
  interval: 60
  logfile: /mystuff/dogger.log
  log_level: info
</pre>
<p>
If your log file is called watcher.yml, you could call the watchdog script
with
</p>
<pre>
  watchdogger -c watcher.yml
</pre>
<p>
(If you omit the log file from the configuration, you&#8216;ll also see the
log output on your console).
</p>
<p>
The script above will check each minute if the web site responds and if the
body matches the given regular expression. If not, it will log a message
and restart the server.
</p>
<p>
There are other options too, just check the API docs for more.
</p>
<p>
To find out the options of the program, call
</p>
<pre>
  watchdogger --help
</pre>
<h1>Why Watchdogger?</h1>
<p>
I wrote this to monitor our instance of Tomcat. While there are other
scripts around, they seem to be either &quot;quick&quot; shell scripts that
require a standard linux layout, or potentially &quot;Enterprise&quot;
solutions with a lot of overhead.
</p>
<p>
This script is just plain Ruby and does not depend on external libraries.
So you should be able to install the gem, set up your configuration and be
good to go. It doesn&#8216;t even assume a particular install location.
</p>
<p>
(In the future there may be some actions or things that require jruby, to
monitor java servers)
</p>
<h1>What if Watchdogger dies?</h1>
<p>
Watchdogger has been designed to run as a daemon, instead of being a cron
job that needs to be called every few minutes. This has several advantages:
We can have state information throughout the session, we can spawn helper
processes if needed, etc.
</p>
<p>
However, the Watchdogger process may die for some reason, which would not
be a good thing.
</p>
<p>
There is an easy solution, though: Just <b>do</b> install Watchdogger as a
cron job. It will check if the old daemon process is still running and exit
with code 1 if that&#8216;s the case. If the old process is stale, it will
restart itself.
</p>

    </div>


   </div>


  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>